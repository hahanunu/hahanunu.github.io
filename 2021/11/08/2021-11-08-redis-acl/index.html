<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Redis 访问控制列表(ACL) | 猿小二's Blog</title><meta name="keywords" content="Redis"><meta name="author" content="猿小二"><meta name="copyright" content="猿小二"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Redis6.0新增了ACL权限控制, 可以按照不同的需求设置相关的用户和权限, 提高安全性。">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis 访问控制列表(ACL)">
<meta property="og:url" content="https://hahanunu.github.io/2021/11/08/2021-11-08-redis-acl/index.html">
<meta property="og:site_name" content="猿小二">
<meta property="og:description" content="Redis6.0新增了ACL权限控制, 可以按照不同的需求设置相关的用户和权限, 提高安全性。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png">
<meta property="article:published_time" content="2021-11-08T11:40:00.000Z">
<meta property="article:modified_time" content="2022-05-03T09:50:00.000Z">
<meta property="article:author" content="猿小二">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://hahanunu.github.io/2021/11/08/2021-11-08-redis-acl/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":180,"position":"top","messagePrev":"注意：这篇文章距离上次更新已有","messageNext":"天了，文章的内容可能已过时。"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redis 访问控制列表(ACL)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-03 17:50:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom@v1.css"><link rel="stylesheet" href="/css/color@v1.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/favicon.ico" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives%60/"><div class="headline">文章</div><div class="length-num">7</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">猿小二's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redis 访问控制列表(ACL)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-08T11:40:00.000Z" title="发表于 2021-11-08 19:40:00">2021-11-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-03T09:50:00.000Z" title="更新于 2022-05-03 17:50:00">2022-05-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Redis/">Redis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redis 访问控制列表(ACL)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在 Redis6.0 之前的版本中，登陆 Redis Server 只需要输入密码（前提配置了密码 requirepass ）即可，不需要输入用户名，而且密码也是明文配置到配置文件中，安全性不高。并且应用连接也使用该密码，导致应用有所有权限处理数据，风险也极高。在 Redis6.0 有了 <a target="_blank" rel="noopener" href="https://redis.io/topics/acl">ACL</a> 之后，终于解决了这些不安全的因素，可以按照不同的需求设置相关的用户和权限。本文来介绍下 Redis 6.0 ACL 相关的配置和使用。具体的说明可以查看官方文档：**<a target="_blank" rel="noopener" href="https://redis.io/topics/acl">ACL</a>** </p>
<h2 id="ACL介绍"><a href="#ACL介绍" class="headerlink" title="ACL介绍"></a>ACL介绍</h2><p>Redis ACL 是 Access Control List 的缩写，是一种特性，它可以限制某些连接的<strong>可执行命令</strong>和<strong>访问 key</strong> 的权限。它的工作方式是，在连接之后，客户端需要提供用户名和有效密码进行身份验证：如果身份验证阶段成功，则连接与给定用户相关联，并限制用户的权限。Redis 可以配置为已经使用 <strong>“default”</strong> 用户（这是默认配置）对新连接进行了身份验证，所以配置 <strong>default</strong> 的用户，作为一个副作用，仅提供一个特定功能的子集，没有明确身份验证的连接。</p>
<p>在默认配置下 ，Redis 6（第一个拥有 ACL 的版本）的工作原理与旧版本的 Redis 完全相同，也就是说，每一个新的连接都能够调用每一个可能的命令和访问每一个 key ，所以ACL功能是向后兼容的。另外，使用requirepass配置指令配置密码的旧方法仍然可以正常工作，但现在它所做的只是为default用户设置密码。</p>
<p>Redis <a target="_blank" rel="noopener" href="https://redis.io/commands/auth">AUTH</a>命令在 Redis 6 中被扩展了，所以它现在可以在两个参数的形式使用它：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AUTH &lt;username&gt; &lt;password&gt;</span><br></pre></td></tr></table></figure>

<p>按旧形式使用时，即：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AUTH &lt;password&gt;</span><br></pre></td></tr></table></figure>

<p>实际情况是，用于身份验证的用户名是“default”，因此仅指定密码就意味着我们要针对默认用户进行身份验证。这提供了与过去完美的向后兼容性。</p>
<h2 id="ACL的作用"><a href="#ACL的作用" class="headerlink" title="ACL的作用"></a>ACL的作用</h2><p>在使用acl之前，您可能想问问自己，通过实现这一层保护，您希望实现什么目标。通常acl可以很好地实现两个主要目标:</p>
<ul>
<li><p>限制对命令和密钥的访问来：</p>
<p>以便不受信任的客户机没有访问权限，而受信任的客户机只有对数据库的最低访问级别，以便执行所需的工作。例如，某些客户端只能执行只读命令。</p>
</li>
<li><p>提高操作安全性：</p>
<p>以防止由于软件错误或人为错误而导致进程或人员访问 Redis，从而破坏数据或配置。例如，从Redis获取延迟作业的worker没有理由能够调用FLUSHALL命令。</p>
</li>
</ul>
<h2 id="ACL-规则"><a href="#ACL-规则" class="headerlink" title="ACL 规则"></a>ACL 规则</h2><p>以下是有效的ACL规则列表。某些规则只是单个单词，用于激活或删除标志，或执行对用户ACL的给定更改。其他规则是与命令或类别名称或键模式等连接的字符前缀。</p>
<h4 id="启用和禁用用户"><a href="#启用和禁用用户" class="headerlink" title="启用和禁用用户"></a>启用和禁用用户</h4><p><code>on</code>：启用用户，可以使用该用户进行身份验证。</p>
<p><code>off</code>：禁用用户，不再可能与该用户进行身份验证，但是已经通过身份验证的连接仍将工作。</p>
<p>注意，如果默认用户被标记为关闭，新的连接开始时将不经过身份验证，并且将要求用户发送带有AUTH选项的AUTH或HELLO以某种方式进行身份验证，而不管默认用户配置如何。</p>
<h4 id="允许和禁止命令"><a href="#允许和禁止命令" class="headerlink" title="允许和禁止命令"></a>允许和禁止命令</h4><p><code>+&lt;command&gt;</code>：将该命令添加到用户可以调用的命令列表中。可以与<code>|</code>一起使用以允许子命令(例如“+config|get”)。</p>
<p><code>—&lt;command&gt;</code>：将命令从用户可以调用的命令列表中移除。可以与<code>|</code>一起用于阻塞子命令(例如“-config|set”)。</p>
<p><code>+@&lt;category&gt;</code>：为用户添加一类命令的权限，有效的类如@admin， @set， @sortedset，…等等，通过调用ACL CAT命令查看完整的列表。特殊类别@all表示所有命令，包括当前在服务器中存在的命令和将来将通过模块加载的命令。</p>
<p><code>-@&lt;category&gt;</code>：类似**+@&lt;category&gt;**，从客户端可以调用的命令列表中删除命令</p>
<p><code>+\&lt;command&gt;|first-arg</code>：允许一个特定的第一个参数，否则禁用命令。注意，这个表单不允许是负数，比如-SELECT|1，而只能是以“+”开头的加法。</p>
<p><code>allcommands</code>：+@all的别名。注意，它意味着能够执行通过模块系统加载的所有未来命令。</p>
<p><code>nocommands</code>： -@all的别名。</p>
<h4 id="允许和禁止某些-key"><a href="#允许和禁止某些-key" class="headerlink" title="允许和禁止某些 key"></a>允许和禁止某些 key</h4><p><code>~&lt;pattern&gt;</code>：添加可以作为命令的一部分提到的键模式。例如~*允许所有的键。该模式是一个全局样式的模式，类似于KEYS模式。可以指定多个模式。</p>
<p><code>allkeys</code>:  也就是~*。</p>
<p><code>resetkeys</code>：刷新允许的键模式列表。例如ACL ~foo:* ~bar:* resetkeys ~objects:*，将导致客户端只能访问匹配模式对象:*的键。</p>
<h4 id="允许和禁止发布-订阅频道"><a href="#允许和禁止发布-订阅频道" class="headerlink" title="允许和禁止发布/订阅频道"></a>允许和禁止发布/订阅频道</h4><p><code>&amp;&lt;pattern&gt;</code>：添加一个用户可以访问的发布/订阅通道的glob样式模式。可以指定多个通道模式。注意，模式匹配只对PUBLISH和SUBSCRIBE提到的通道进行，而PSUBSCRIBE要求在其通道模式和用户允许的通道模式之间进行文字匹配。</p>
<p><code>allchannels</code>：&amp;*别名，允许用户访问所有发布/订阅通道</p>
<p><code>resetchannels</code>：刷新允许的通道模式列表，如果用户的发布/订阅客户端不再能够访问各自的通道和/或通道模式，则断开这些客户端。</p>
<h4 id="为用户配置有效的密码"><a href="#为用户配置有效的密码" class="headerlink" title="为用户配置有效的密码"></a>为用户配置有效的密码</h4><p><code>&gt;&lt;password&gt;</code>：将此密码添加到用户的有效密码列表中。例如，&gt;mypass将把“mypass”添加到有效密码列表中。该指令清除nopass标志(参见后面的内容)。每个用户可以有任意数量的密码。</p>
<p><code>&lt;&lt;password&gt;</code>：从有效密码列表中删除此密码。如果删除的密码实际上没有设置，则将发出错误。</p>
<p><code>#&lt;hash&gt;</code>：将此SHA-256哈希值添加到该用户的有效密码列表中。此hash值将与为ACL用户输入的密码的hash值进行比较。这允许用户将hash值存储在acl.conf文件中，而不是存储明文密码。只能接受SHA-256哈希值，因为密码hash值必须为64个字符，且只能包含小写的十六进制字符。</p>
<p><code>!&lt;hash&gt;</code>：从有效密码列表中删除此hash值。当您不知道由hash值指定的密码，但希望从用户中删除密码时，这是非常有用的。</p>
<p><code>nopass</code>：用户设置的所有密码都被删除，用户被标记为不需要密码:这意味着每个密码都适用于该用户。如果将此指令用于默认用户，则每个新连接都将立即使用默认用户进行身份验证，而不需要任何显式的AUTH命令。注意，resetpass指令将清除这个条件。</p>
<p><code>resetpass</code>：清除允许的密码列表。此外，还删除了nopass状态。重置后，用户没有相关的密码，如果不添加一些密码(或稍后设置为nopass)，就无法进行身份验证。</p>
<h4 id="重置用户"><a href="#重置用户" class="headerlink" title="重置用户"></a>重置用户</h4><p><code>rest</code>：执行以下操作:resetpass, resetkeys, resetchannels, off， -@all。用户在创建后立即返回到相同的状态。</p>
<h2 id="使用-ACL-命令配置-ACL"><a href="#使用-ACL-命令配置-ACL" class="headerlink" title="使用 ACL 命令配置 ACL"></a>使用 ACL 命令配置 ACL</h2><p>acl是使用DSL(领域特定语言)定义的，DSL描述了给定用户能够做什么或不能做什么。这样的规则总是从第一个到最后一个，从左到右实现，因为有时规则的顺序对理解用户真正能够做什么很重要。</p>
<p>首先看 ACL 的 help，了解大致的使用方法：ACL help</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ACL <span class="built_in">help</span></span><br><span class="line"> 1) ACL &lt;subcommand&gt; arg arg ... arg. Subcommands are:</span><br><span class="line"> 2) LOAD                             -- 从ACL文件中重新载入用户信息.</span><br><span class="line"> 3) SAVE                             -- 保存当前的用户配置信息到ACL文件.</span><br><span class="line"> 4) LIST                             -- 以配置文件格式显示用户详细信息.</span><br><span class="line"> 5) USERS                            -- 列出所有注册的用户名.</span><br><span class="line"> 6) SETUSER &lt;username&gt; [attribs ...] -- 创建或则修改一个用户.</span><br><span class="line"> 7) GETUSER &lt;username&gt;               -- 得到一个用户的详细信息.</span><br><span class="line"> 8) DELUSER &lt;username&gt; [...]         -- 删除列表中的用户.</span><br><span class="line"> 9) CAT                              -- 列出可用的类别.</span><br><span class="line">10) CAT &lt;category&gt;                   -- 列出指定类别中的命令.</span><br><span class="line">11) GENPASS [&lt;bits&gt;]                 -- 生成一个安全的用户密码.</span><br><span class="line">12) WHOAMI                           -- 返回当前的连接用户.</span><br><span class="line">13) LOG [&lt;count&gt; | RESET]            -- 显示ACL日志条目.</span><br></pre></td></tr></table></figure>

<p>默认情况下，redis只定义了一个用户，称为<strong>default</strong>。</p>
<p>我们可以使用<strong>ACL LIST</strong>命令来检查当前启用的ACL，并验证一个刚启动的、默认配置的Redis实例的配置是什么:</p>
<p>默认 default 用户，没有配置密码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; acl list</span><br><span class="line">1) <span class="string">&quot;user default on nopass ~* &amp;* +@all&quot;</span></span><br></pre></td></tr></table></figure>

<p>配置密码的：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; acl list</span><br><span class="line">1) <span class="string">&quot;user onlyread on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span></span><br></pre></td></tr></table></figure>


<table>
<thead>
<tr>
<th>参 数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>user</td>
<td>用户</td>
</tr>
<tr>
<td>default</td>
<td>表示默认用户名，或则自己定义的用户名</td>
</tr>
<tr>
<td>on</td>
<td>表示是否启用该用户，默认为 off（禁用）</td>
</tr>
<tr>
<td>#…</td>
<td>表示用户密码，nopass 表示不需要密码</td>
</tr>
<tr>
<td>~*</td>
<td>表示可以访问的 Key（正则匹配）</td>
</tr>
<tr>
<td>&amp;*</td>
<td>Pub/Sub通道(发布/订阅)</td>
</tr>
<tr>
<td>+@</td>
<td>表示用户的权限，+/- 表示授权还是销权； @为权限类。+@all 表示所有权限</td>
</tr>
</tbody></table>
<p>权限对 key 的类型和命令的类型进行了分类，如有对数据类型进行分类：string、hash、list、set、sortedset，和对命令类型进行分类：connection、admin、dangerous。</p>
<h2 id="配置实例"><a href="#配置实例" class="headerlink" title="配置实例"></a>配置实例</h2><h4 id="密码相关"><a href="#密码相关" class="headerlink" title="密码相关"></a>密码相关</h4><p>1、配置密码：一个用户可以设置不同的密码，即一个用户可以有多个密码。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 添加密码 </span><br><span class="line">## &gt;开头: &gt;password，明文密码；</span><br><span class="line">&gt; ACL SETUSER zhoujy on &gt;abc</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"># 获取哈希值密码 echo -n &quot;cba&quot; | shasum -a 256</span><br><span class="line">6d970874d0db767a7058798973f22cf6589601edab57996312f2ef7b56e5584d</span><br><span class="line"></span><br><span class="line">## #开头: #hash，SHA-256哈希值</span><br><span class="line">&gt; ACL SETUSER zhoujy on #6d970874d0db767a7058798973f22cf6589601edab57996312f2ef7b56e5584d</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL GETUSER zhoujy</span><br><span class="line">1) &quot;flags&quot;</span><br><span class="line">2) 1) &quot;on&quot;</span><br><span class="line">3) &quot;passwords&quot;</span><br><span class="line">4) 1) &quot;ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad&quot;</span><br><span class="line">   2) &quot;6d970874d0db767a7058798973f22cf6589601edab57996312f2ef7b56e5584d&quot;</span><br><span class="line">5) &quot;commands&quot;</span><br><span class="line">6) &quot;-@all&quot;</span><br><span class="line">7) &quot;keys&quot;</span><br><span class="line">8) (empty array)</span><br><span class="line"></span><br><span class="line">## 认证密码</span><br><span class="line">&gt; AUTH zhoujy abc</span><br><span class="line">OK</span><br><span class="line">&gt; AUTH zhoujy cba</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 移除密码</span><br><span class="line">## &lt;开头: &lt;password ，明文密码</span><br><span class="line">&gt; ACL SETUSER zhoujy &lt;abc</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 用!开头: !hash，SHA-256哈希值</span><br><span class="line">&gt; ACL SETUSER zhoujy on !6d970874d0db767a7058798973f22cf6589601edab57996312f2ef7b56e5584d</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL GETUSER zhoujy</span><br><span class="line">1) &quot;flags&quot;</span><br><span class="line">2) 1) &quot;on&quot;</span><br><span class="line">3) &quot;passwords&quot;</span><br><span class="line">4) (empty array)</span><br><span class="line">5) &quot;commands&quot;</span><br><span class="line">6) &quot;-@all&quot;</span><br><span class="line">7) &quot;keys&quot;</span><br><span class="line">8) (empty array)</span><br><span class="line"></span><br><span class="line">## 认证密码</span><br><span class="line">&gt; AUTH zhoujy abc</span><br><span class="line">(error) WRONGPASS invalid username-password pair</span><br></pre></td></tr></table></figure>

<p>2、清理 / 删除密码：通过 nopass 清理用户的密码，但是该用户连接还是需要 AUTH，只是密码可以是任意值</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 清理/删除密码，可以用任意密码登陆</span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL GETUSER zhoujy</span><br><span class="line">1) &quot;flags&quot;</span><br><span class="line">2) 1) &quot;on&quot;</span><br><span class="line">   2) &quot;allkeys&quot;</span><br><span class="line">   3) &quot;allcommands&quot;</span><br><span class="line">3) &quot;passwords&quot;</span><br><span class="line">4) 1) &quot;ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad&quot;</span><br><span class="line">   2) &quot;6d970874d0db767a7058798973f22cf6589601edab57996312f2ef7b56e5584d&quot;</span><br><span class="line">5) &quot;commands&quot;</span><br><span class="line">6) &quot;+@all&quot;</span><br><span class="line">7) &quot;keys&quot;</span><br><span class="line">8) 1) &quot;*&quot;</span><br><span class="line"></span><br><span class="line">## 删除、清理用户密码</span><br><span class="line">&gt; ACL SETUSER zhoujy nopass</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL GETUSER zhoujy</span><br><span class="line">1) &quot;flags&quot;</span><br><span class="line">2) 1) &quot;on&quot;</span><br><span class="line">   2) &quot;allkeys&quot;</span><br><span class="line">   3) &quot;allcommands&quot;</span><br><span class="line">   4) &quot;nopass&quot;</span><br><span class="line">3) &quot;passwords&quot;</span><br><span class="line">4) (empty array)</span><br><span class="line">5) &quot;commands&quot;</span><br><span class="line">6) &quot;+@all&quot;</span><br><span class="line">7) &quot;keys&quot;</span><br><span class="line">8) 1) &quot;*&quot;</span><br><span class="line"></span><br><span class="line">## 验证</span><br><span class="line">&gt; AUTH zhoujy  --需要AUTH</span><br><span class="line">(error) WRONGPASS invalid username-password pair</span><br><span class="line"></span><br><span class="line">&gt; AUTH zhoujy &#x27;&#x27;  --可以输入任何密码</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 清理/删除密码，不能登陆，需要设置密码后才能登陆</span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL GETUSER zhoujy</span><br><span class="line">1) &quot;flags&quot;</span><br><span class="line">2) 1) &quot;on&quot;</span><br><span class="line">   2) &quot;allkeys&quot;</span><br><span class="line">   3) &quot;allcommands&quot;</span><br><span class="line">3) &quot;passwords&quot;</span><br><span class="line">4) 1) &quot;ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad&quot;</span><br><span class="line">   2) &quot;6d970874d0db767a7058798973f22cf6589601edab57996312f2ef7b56e5584d&quot;</span><br><span class="line">5) &quot;commands&quot;</span><br><span class="line">6) &quot;+@all&quot;</span><br><span class="line">7) &quot;keys&quot;</span><br><span class="line">8) 1) &quot;*&quot;</span><br><span class="line"></span><br><span class="line">## 删除、清理用户密码</span><br><span class="line">&gt; ACL SETUSER zhoujy resetpass</span><br><span class="line">OK</span><br><span class="line">&gt; ACL GETUSER zhoujy</span><br><span class="line">1) &quot;flags&quot;</span><br><span class="line">2) 1) &quot;on&quot;</span><br><span class="line">   2) &quot;allkeys&quot;</span><br><span class="line">   3) &quot;allcommands&quot;</span><br><span class="line">3) &quot;passwords&quot;</span><br><span class="line">4) (empty array)</span><br><span class="line">5) &quot;commands&quot;</span><br><span class="line">6) &quot;+@all&quot;</span><br><span class="line">7) &quot;keys&quot;</span><br><span class="line">8) 1) &quot;*&quot;</span><br><span class="line"></span><br><span class="line">## 验证，被resetpass重置密码之后，不能登陆，只能设置密码或则设置nopass才能登陆</span><br><span class="line">&gt; AUTH zhoujy</span><br><span class="line">(error) WRONGPASS invalid username-password pair</span><br><span class="line"></span><br><span class="line">&gt; AUTH zhoujy &#x27;&#x27;</span><br><span class="line">(error) WRONGPASS invalid username-password pair</span><br></pre></td></tr></table></figure>

<p>3、重置用户和密码：实际上是执行 resetpass，resetkeys，off，-@all</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line"></span><br><span class="line">## 重置用户</span><br><span class="line">&gt; ACL SETUSER zhoujy reset</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy off -@all&quot;</span><br></pre></td></tr></table></figure>

<p>4、获取随机密码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 生成随机密码</span><br><span class="line">&gt; ACL GENPASS</span><br><span class="line">&quot;7a3288b05577cb6fea9b1a9a8bcfe10d9589e64be74e8a0e16c131ba896c7bde&quot;</span><br></pre></td></tr></table></figure>

<h4 id="键模式"><a href="#键模式" class="headerlink" title="键模式"></a>键模式</h4><p><code>~&lt;pattern&gt;</code>，通配符模式。比如： <del>* 表示允许访问所有 key，也可以用 `<strong>allkeys</strong>来表示**</del>***。**resetkeys** 表示清空它之前所有的键模式，之后的键模式不影响。`</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 可以操作foo开头和bar:开头的所有key</span><br><span class="line">&gt; ACL SETUSER zhoujy on &gt;abc ~foo* ~bar:*+@all</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~foo* ~bar:*+@all&quot;</span><br><span class="line"></span><br><span class="line">--  只能操作ob:开头的key，前面的key模式被resetkeys清空了</span><br><span class="line">&gt; ACL SETUSER zhoujy on &gt;abc ~foo* ~bar:* resetkeys ~ob:*+@all</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~ob:*+@all&quot;</span><br><span class="line"></span><br><span class="line">-- 操作所有key，allkeys 和 ~* 一样</span><br><span class="line">&gt; ACL SETUSER zhoujy allkeys +@all</span><br><span class="line">OK</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~*+@all&quot;</span><br></pre></td></tr></table></figure>

<h4 id="权限相关"><a href="#权限相关" class="headerlink" title="权限相关"></a>权限相关</h4><p>权限这块涉及到的比较多：权限的类别、类别里包含的命令，以及子权限。<br>注意：**-@all** 表示没有任何权限；**+@all** 表示有所有权限；</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 返回权限的类别</span><br><span class="line">&gt; ACL CAT</span><br><span class="line"> 1) &quot;keyspace&quot;</span><br><span class="line"> 2) &quot;read&quot;</span><br><span class="line"> 3) &quot;write&quot;</span><br><span class="line"> 4) &quot;set&quot;</span><br><span class="line"> 5) &quot;sortedset&quot;</span><br><span class="line"> 6) &quot;list&quot;</span><br><span class="line"> 7) &quot;hash&quot;</span><br><span class="line"> 8) &quot;string&quot;</span><br><span class="line"> 9) &quot;bitmap&quot;</span><br><span class="line">10) &quot;hyperloglog&quot;</span><br><span class="line">11) &quot;geo&quot;</span><br><span class="line">12) &quot;stream&quot;</span><br><span class="line">13) &quot;pubsub&quot;</span><br><span class="line">14) &quot;admin&quot;</span><br><span class="line">15) &quot;fast&quot;</span><br><span class="line">16) &quot;slow&quot;</span><br><span class="line">17) &quot;blocking&quot;</span><br><span class="line">18) &quot;dangerous&quot;</span><br><span class="line">19) &quot;connection&quot;</span><br><span class="line">20) &quot;transaction&quot;</span><br><span class="line">21) &quot;scripting&quot;</span><br><span class="line"></span><br><span class="line">-- 返回指定类别中的命令，下面hash是上面返回的一个结果</span><br><span class="line">&gt; ACL CAT hash</span><br><span class="line"> 1) &quot;hsetnx&quot;</span><br><span class="line"> 2) &quot;hset&quot;</span><br><span class="line"> 3) &quot;hlen&quot;</span><br><span class="line"> 4) &quot;hmget&quot;</span><br><span class="line"> 5) &quot;hincrbyfloat&quot;</span><br><span class="line"> 6) &quot;hgetall&quot;</span><br><span class="line"> 7) &quot;hvals&quot;</span><br><span class="line"> 8) &quot;hscan&quot;</span><br><span class="line"> 9) &quot;hkeys&quot;</span><br><span class="line">10) &quot;hstrlen&quot;</span><br><span class="line">11) &quot;hget&quot;</span><br><span class="line">12) &quot;hdel&quot;</span><br><span class="line">13) &quot;hexists&quot;</span><br><span class="line">14) &quot;hincrby&quot;</span><br><span class="line">15) &quot;hmset&quot; </span><br></pre></td></tr></table></figure>

<p>从上面的权限列表里看到：权限对 key 的类型和命令的类型进行了分类，如有对类型进行分类：string、hash、list、set、sortedset，和对命令类型进行分类：connection、admin、dangerous。 以及对每个分类的方法进行说明，如上面查看 hash 类型 key 的一些方法。</p>
<p><strong>授权方法</strong>：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+&lt;command&gt;：将命令添加到用户可以调用的命令列表中，如+@hash</span><br><span class="line">-&lt;command&gt;: 将命令从用户可以调用的命令列表中移除</span><br><span class="line">+@&lt;category&gt;: 添加一类命令，如：@admin, @set, @hash ... 可以ACL CAT 查看具体的操作指令。特殊类别@all表示所有命令，包括当前在服务器中存在的命令，以及将来将通过模块加载的命令</span><br><span class="line">-@&lt;category&gt;: 类似+@&lt;category&gt;，从客户端可以调用的命令列表中删除命令</span><br><span class="line">+&lt;command&gt;|subcommand: 允许否则禁用特定子命令。注意，这种形式不允许像-DEBUG | SEGFAULT那样，而只能以“ +”开头</span><br><span class="line">allcommands：+@all的别名，允许所有命令操作执行。注意，这意味着可以执行将来通过模块系统加载的所有命令。</span><br><span class="line">nocommands：-@all的别名，不允许所有命令操作执行。</span><br></pre></td></tr></table></figure>

<p>1、添加指定类型的权限：+@hash</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 添加hash类型key的所有权限</span><br><span class="line">&gt; ACL SETUSER zhoujy +@hash</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* -@all +@hash&quot; </span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：用户 zhoujy 只有对 hash 类型的 key 有权限。</p>
<p>2、删除指定类型的权限：-@hash</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 删除hash类型key的所有权限</span><br><span class="line">&gt; ACL SETUSER zhoujy -@hash +@string</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad -@all +@string&quot;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：用户 zhoujy 移除对 hash 类型的 key 有权限。</p>
<p>3、指定特定 key 的权限：如 sortedset：~z*，z 开头的 key</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 访问指定key的正则</span><br><span class="line">&gt; ACL SETUSER zhoujy ~z* +@sortedset -@string</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~z* -@all +@sortedset&quot;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：用户 zhoujy 只有对 z 开头的 key 有权限。</p>
<p>4、授权只读 / 只写的权限：+@read、+@write</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 授权所有key的只读权限</span><br><span class="line">&gt; ACL SETUSER zhoujy ~* +@read</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">##查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* -@all +@read +@hash +@bitmap +@geo -georadiusbymember -hsetnx -setbit -hset -geoadd -bitop -hincrbyfloat -hdel -bitfield -hincrby -hmset -georadius&quot;</span><br><span class="line"></span><br><span class="line">-- 授权所有key的只写权限</span><br><span class="line">&gt; ACL SETUSER zhoujy +@write</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">##查看</span><br><span class="line">192.168.163.134:8379&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* -@all +@write +@list +@string +@stream +@fast +@blocking -dbsize -getrange -scard -xrevrange -zrank -llen -xread -ttl -get -ping -watch -publish -hlen -xrange -stralgo -zcount -getbit -lastsave -readonly -hmget -hello -zcard -discard -hstrlen -xinfo -hget -exists -bitfield_ro -select -role -zlexcount -zrevrank -lolwut -hexists -touch -lindex -unwatch -sismember -strlen -xlen -asking -type -mget -time -xpending -echo -multi -auth -readwrite -lrange -pttl -zscore -substr&quot;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：用户 zhoujy 对所有 key 有只读或则只写的权限，如果下个这对指定 key，则替换 <strong>~*</strong> 即可。</p>
<p>5、授权管理权限：@admin</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 授权管理权限</span><br><span class="line">&gt; ACL SETUSER zhoujy on &gt;abc ~* +@admin</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">## 查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* -@all +@admin +@dangerous -flushall -flushdb -swapdb -keys -role -sort -migrate -restore-asking -restore -info&quot;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：用户 zhoujy 有管理权限，包含了危险操作的类型，但排除了 <strong>-</strong> 开头命令的权限。</p>
<p>6、允许特定类型 key 的子命令权限：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 设置子命令。</span><br><span class="line">&gt; ACL SETUSER zhoujy on &gt;abc ~* -client +client|getname +client|setname</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">##查看</span><br><span class="line">&gt; ACL LIST</span><br><span class="line">1) &quot;user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all&quot;</span><br><span class="line">2) &quot;user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* -@all +client|getname +client|setname&quot;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：开始删除 CLIENT 命令，然后添加了两个允许的子命令。请注意，不能相反，即不能 + 在前面，只能添加而不是排除子命令，因为将来可能会添加新的子命令。<strong>注意</strong>子命令匹配可能会增加一些性能损失。</p>
<p>7、特定用途的账号权限：Sentinel 和 Replicas</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- Sentinel：允许用户在主和副本实例中都有以下命令权限</span><br><span class="line">&gt; ACL SETUSER sentinel-user &gt;somepassword +client +subscribe +publish +ping +info +multi +slaveof +config +client +exec on</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">-- Replicas:副本需要在主实例上有以下命令权限</span><br><span class="line">&gt; ACL SETUSER replica-user &gt;somepassword +psync +replconf +ping on</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>



<h4 id="保存、加载相关：save、load"><a href="#保存、加载相关：save、load" class="headerlink" title="保存、加载相关：save、load"></a>保存、加载相关：save、load</h4><p>通过 ACL 创建的用户是保存在内存里的，如果 Redis Server 重启则 ACL 创建的用户会丢失，所以在创建完用户后需要用 <strong>save</strong> 保存，在重启之后需要用 <strong>load</strong> 加载。有两种方式进行保存和加载：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1，使用ACL命令:ACL SAVE、ACL LOAD</span><br><span class="line">2，使用Redis配置，用户被定义，然后重启服务器并生效。 或者使用外部ACL文件，使用ACL LOAD 来导入ACL信息</span><br></pre></td></tr></table></figure>

<p><strong>注意：ACL 的配合文件需要事先手动 touch，否则实例启动会失败。</strong>在 redis.conf 里配置和 acl 文件里配置的方法互不兼容，Redis 会要求使用其中一种。 否则实例启动报错：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 报错信息</span><br><span class="line">#Configuring Redis with users defined in redis.conf and at the same setting an ACL file path is invalid. This setup is very likely to lead to configuration errors and security holes, please define either an ACL file or declare users directly in your redis.conf, but not both.</span><br></pre></td></tr></table></figure>

<p>在 redis.conf 中指定用户是一种非常简单的方法，适用于简单的用例。 当有多个用户要定义时，在复杂的环境中，强烈建议使用 ACL 文件。该 2 个文件里的配置内容是一致的，可以相互进行配置，如格式如下：在 redis.conf 和 users.acl 里的格式</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 配置文件</span><br><span class="line">user default on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all</span><br><span class="line">user zhoujy on #ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad ~* +@all</span><br></pre></td></tr></table></figure>

<p>1、保存 ACL 规则</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 保存ACL规则</span><br><span class="line">&gt; ACL SAVE</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>2、加载 ACL 规则</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 加载ACL规则</span><br><span class="line">&gt; ACL LOAD</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>：在使用 ACL 配置文件之后，如果设置了默认用户（default）规则的话，需要看配置文件中 aclfile 和 requirepass 参数的先后顺序，密码以最后出现的为准。</p>
<h4 id="日志相关"><a href="#日志相关" class="headerlink" title="日志相关"></a>日志相关</h4><p>显示最近的 ACL 安全事件列表<br>通过 ACL LOG [<count> | RESET] 返回 ACL 的日志信息，可以指定条目显示，也可以进行重置：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 显示日志信息</span><br><span class="line">&gt; ACL LOG 1</span><br><span class="line">1)  1) &quot;count&quot;</span><br><span class="line">    2) (integer) 1</span><br><span class="line">    3) &quot;reason&quot;</span><br><span class="line">    4) &quot;auth&quot;</span><br><span class="line">    5) &quot;context&quot;</span><br><span class="line">    6) &quot;toplevel&quot;</span><br><span class="line">    7) &quot;object&quot;</span><br><span class="line">    8) &quot;AUTH&quot;</span><br><span class="line">    9) &quot;username&quot;</span><br><span class="line">   10) &quot;zhoujy&quot;</span><br><span class="line">   11) &quot;age-seconds&quot;</span><br><span class="line">   12) &quot;282.90499999999997&quot;</span><br><span class="line">   13) &quot;client-info&quot;</span><br><span class="line">   14) &quot;id=5 addr=192.168.163.134:35246 fd=7 name= age=403 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=36 qbuf-free=32732 obl=0 oll=0 omem=0 events=r cmd=auth user=zhoujy&quot;</span><br><span class="line"></span><br><span class="line">-- 重置日志，类似slow</span><br><span class="line">&gt; acl log reset</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<h2 id="场景说明"><a href="#场景说明" class="headerlink" title="场景说明"></a>场景说明</h2><p><strong>注意：</strong>以上操作完只有需要执行 ACL SAVE。不然重置之后用户信息全部都清空了。</p>
<ol>
<li><p>创建 DBA 管理账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ACL SETUSER dba on #6d0ac515af9df81653ed0aa3ffa692663c3f556079791e2f00a4578990da66f3 allkeys +@all</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li><p>创建读写账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ACL SETUSER readwrite on &gt;abc allkeys -@all +@read +@write</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li><p>创建只读账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ACL SETUSER readonly on &gt;abc allkeys -@all +@read</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li><p>创建只写账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ACL SETUSER write_user on &gt;abc allkeys -@all +@write</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li><p>创建复制账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ACL SETUSER replica-user &gt;abc -@all +psync +replconf +ping on</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li><p>创建哨兵账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ACL SETUSER sentinel-user &gt;abc -@all +client +subscribe +publish +ping +info +multi +slaveof +config +client +exec on</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li><p>创建监控账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; ACL SETUSER monitor on &gt;abc +monitor</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></li>
<li><p>创建指定 key、有指定类型权限的账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- 指定对h开头的hash类型的key有权限</span><br><span class="line">&gt; ACL SETUSER ops_user on &gt;abc ~h* +@hash</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>其中 key 的模式是正则匹配，需要 <strong>~</strong> 开头，针对权限则是 hash 的类，其权限可以通过 ACL CAT hash 查看。</p>
</li>
</ol>
<h2 id="使用外部-ACL-文件"><a href="#使用外部-ACL-文件" class="headerlink" title="使用外部 ACL 文件"></a>使用外部 ACL 文件</h2><p>有两种方法可以将用户存储在 Redis 配置中，一种是 <code>redis.conf</code> 中配置，一种是使用一个独立的外部 acl 文件，这两种方式不兼容，只能选择一种方式。</p>
<p>在<code>redis.conf</code>内部指定用户是一种非常简单的方法，适用于简单的用例。当需要定义多个用户时，在复杂的环境中，我们强烈建议您使用 ACL 文件。</p>
<p>通常外部文件的方式更灵活，推荐使用。</p>
<p>配置内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user &lt;username&gt; ... acl rules ...</span><br></pre></td></tr></table></figure>

<p>来看一个示例：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user worker +@list +@connection ~jobs:* on &gt;ffa9203c493aa99</span><br></pre></td></tr></table></figure>

<p>当您要使用外部 ACL 文件时，需要在 redis.conf 文件中设置 <code>aclfile</code>文件的路径，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">aclfile /etc/redis/users.acl</span><br></pre></td></tr></table></figure>

<p>当仅在 redis.conf 文件内部直接指定几个用户时，可以使用 CONFIG REWRITE 以便通过重写将新的用户配置存储在文件中。</p>
<p>但是，外部 ACL 文件功能更强大。您可以执行以下操作：</p>
<ul>
<li>使用 <code>ACL LOAD</code> 重新加载外部 ACL 文件，通常在你手动修改了这个文件，希望 redis 重新加载的时候使用，需要注意的是要确保 acl 文件内容的正确性</li>
<li>使用 <code>ACL SAVE</code> 将当前 ACL 配置保存到一个外部文件</li>
</ul>
<div class="note success flat"><p><strong>参考文档</strong></p>
<p><a target="_blank" rel="noopener" href="https://redis.io/topics/acl">https://redis.io/topics/acl</a></p>
<p><a target="_blank" rel="noopener" href="https://redis.io/commands/acl-setuser">https://redis.io/commands/acl-setuser</a></p>
</div>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">猿小二</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://hahanunu.github.io/2021/11/08/2021-11-08-redis-acl/">https://hahanunu.github.io/2021/11/08/2021-11-08-redis-acl/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hahanunu.github.io" target="_blank">猿小二's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/23/2021-12-23-k8s-gitlabci-layer/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Gitlab CI 在 Kubernetes 中的 Docker 缓存</div></div></a></div><div class="next-post pull-right"><a href="/2021/08/17/2021-08-17-github-to-gitee/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">利用Github Action实现Github到Gitee的持续同步</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/favicon.ico" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">猿小二</div><div class="author-info__description">猿小二's Blog</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives%60/"><div class="headline">文章</div><div class="length-num">7</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/like-ycy/"><i class="fab fa-github"></i><span>Follow Me Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/like-ycy" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">保持热爱, 奔赴山海!!!<div class="twopeople"><div class="twopeople"><div class="container"style="height:200px;"><canvas class="illo"width="800"height="800"style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="/js/twopeople1.js"></script><script src="/js/zdog.dist.js"></script><script id="rendered-js"src="/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACL%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">ACL介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACL%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">ACL的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACL-%E8%A7%84%E5%88%99"><span class="toc-number">4.</span> <span class="toc-text">ACL 规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%92%8C%E7%A6%81%E7%94%A8%E7%94%A8%E6%88%B7"><span class="toc-number">4.0.1.</span> <span class="toc-text">启用和禁用用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%81%E8%AE%B8%E5%92%8C%E7%A6%81%E6%AD%A2%E5%91%BD%E4%BB%A4"><span class="toc-number">4.0.2.</span> <span class="toc-text">允许和禁止命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%81%E8%AE%B8%E5%92%8C%E7%A6%81%E6%AD%A2%E6%9F%90%E4%BA%9B-key"><span class="toc-number">4.0.3.</span> <span class="toc-text">允许和禁止某些 key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%81%E8%AE%B8%E5%92%8C%E7%A6%81%E6%AD%A2%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E9%A2%91%E9%81%93"><span class="toc-number">4.0.4.</span> <span class="toc-text">允许和禁止发布&#x2F;订阅频道</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%9C%89%E6%95%88%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">4.0.5.</span> <span class="toc-text">为用户配置有效的密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E7%94%A8%E6%88%B7"><span class="toc-number">4.0.6.</span> <span class="toc-text">重置用户</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-ACL-%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE-ACL"><span class="toc-number">5.</span> <span class="toc-text">使用 ACL 命令配置 ACL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B"><span class="toc-number">6.</span> <span class="toc-text">配置实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%9B%B8%E5%85%B3"><span class="toc-number">6.0.1.</span> <span class="toc-text">密码相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%AE%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.0.2.</span> <span class="toc-text">键模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3"><span class="toc-number">6.0.3.</span> <span class="toc-text">权限相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E3%80%81%E5%8A%A0%E8%BD%BD%E7%9B%B8%E5%85%B3%EF%BC%9Asave%E3%80%81load"><span class="toc-number">6.0.4.</span> <span class="toc-text">保存、加载相关：save、load</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%9B%B8%E5%85%B3"><span class="toc-number">6.0.5.</span> <span class="toc-text">日志相关</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E"><span class="toc-number">7.</span> <span class="toc-text">场景说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8-ACL-%E6%96%87%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">使用外部 ACL 文件</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/04/03/2023-04-03-ai-tools/" title="32 个实用又高效的免费 AI 工具"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="32 个实用又高效的免费 AI 工具"/></a><div class="content"><a class="title" href="/2023/04/03/2023-04-03-ai-tools/" title="32 个实用又高效的免费 AI 工具">32 个实用又高效的免费 AI 工具</a><time datetime="2023-04-02T16:00:00.000Z" title="发表于 2023-04-03 00:00:00">2023-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/03/2022-08-23-page-front-matter/" title="文章 front-matter 头部参数示例"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="文章 front-matter 头部参数示例"/></a><div class="content"><a class="title" href="/2022/08/03/2022-08-23-page-front-matter/" title="文章 front-matter 头部参数示例">文章 front-matter 头部参数示例</a><time datetime="2022-08-02T16:00:00.000Z" title="发表于 2022-08-03 00:00:00">2022-08-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/06/2022-02-06-githubactions-pull-images/" title="无法拉取 gcr.io 镜像？用魔法来打败魔法"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无法拉取 gcr.io 镜像？用魔法来打败魔法"/></a><div class="content"><a class="title" href="/2022/02/06/2022-02-06-githubactions-pull-images/" title="无法拉取 gcr.io 镜像？用魔法来打败魔法">无法拉取 gcr.io 镜像？用魔法来打败魔法</a><time datetime="2022-02-05T16:00:00.000Z" title="发表于 2022-02-06 00:00:00">2022-02-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/23/2021-12-23-k8s-gitlabci-layer/" title="Gitlab CI 在 Kubernetes 中的 Docker 缓存"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Gitlab CI 在 Kubernetes 中的 Docker 缓存"/></a><div class="content"><a class="title" href="/2021/12/23/2021-12-23-k8s-gitlabci-layer/" title="Gitlab CI 在 Kubernetes 中的 Docker 缓存">Gitlab CI 在 Kubernetes 中的 Docker 缓存</a><time datetime="2021-12-22T16:00:00.000Z" title="发表于 2021-12-23 00:00:00">2021-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/08/2021-11-08-redis-acl/" title="Redis 访问控制列表(ACL)"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis 访问控制列表(ACL)"/></a><div class="content"><a class="title" href="/2021/11/08/2021-11-08-redis-acl/" title="Redis 访问控制列表(ACL)">Redis 访问控制列表(ACL)</a><time datetime="2021-11-08T11:40:00.000Z" title="发表于 2021-11-08 19:40:00">2021-11-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/CDN/img/material-10.png')"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By 猿小二</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://hahanunu.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>